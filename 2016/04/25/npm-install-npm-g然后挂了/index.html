<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> npm install npm -g然后挂了 · lifelover</title><meta name="description" content="npm install npm -g然后挂了 - jingxiao"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="lifelover"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/lifesimple1991" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/LeoWang1991" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">npm install npm -g然后挂了</h1><div class="post-info">Apr 25, 2016</div><div class="post-content"><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>OS X想通过命令行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm install npm -g/ npm update -g</div></pre></td></tr></table></figure>
<p>提示好像是没有权限吧，恩，全局安装又忘了加<code>sudo</code></p>
<p>然而再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo npm install npm -g</div></pre></td></tr></table></figure>
<p>然而没反应啊，显示</p>
<p><code>-bash: /usr/local/bin/npm: No such file or directory</code></p>
<p>大概就是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$ npm update npm -g</div><div class="line">npm http GET https://registry.npmjs.org/npm</div><div class="line">npm http 304 https://registry.npmjs.org/npm</div><div class="line">npm http GET https://registry.npmjs.org/npm/1.4.4</div><div class="line">npm http 304 https://registry.npmjs.org/npm/1.4.4</div><div class="line">npm ERR! error rolling back Error: Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/node_modules/npm</div><div class="line">npm ERR! error rolling back     at clobberFail (/usr/local/Cellar/node/0.10.26/lib/node_modules/npm/lib/utils/gently-rm.js:57:12)</div><div class="line">npm ERR! error rolling back     at next (/usr/local/Cellar/node/0.10.26/lib/node_modules/npm/lib/utils/gently-rm.js:43:14)</div><div class="line">npm ERR! error rolling back     at /usr/local/Cellar/node/0.10.26/lib/node_modules/npm/lib/utils/gently-rm.js:52:12</div><div class="line">npm ERR! error rolling back     at Object.oncomplete (fs.js:107:15)</div><div class="line">npm ERR! error rolling back  npm@1.4.4 &#123; [Error: Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/node_modules/npm] code: &apos;EEXIST&apos;, path: &apos;/usr/local/bin/npm&apos; &#125;</div><div class="line">npm ERR! Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/node_modules/npm</div><div class="line">File exists: /usr/local/bin/npm</div><div class="line">Move it away, and try again. </div><div class="line"></div><div class="line">npm ERR! System Darwin 13.1.0</div><div class="line">npm ERR! command &quot;/usr/local/Cellar/node/0.10.26/bin/node&quot; &quot;/usr/local/bin/npm&quot; &quot;update&quot; &quot;npm&quot; &quot;-g&quot;</div><div class="line">npm ERR! cwd /Users/dan/Google Drive/Projects/dotfiles</div><div class="line">npm ERR! node -v v0.10.26</div><div class="line">npm ERR! npm -v 1.4.3</div><div class="line">npm ERR! path /usr/local/bin/npm</div><div class="line">npm ERR! code EEXIST</div><div class="line">npm ERR! </div><div class="line">npm ERR! Additional logging details can be found in:</div><div class="line">npm ERR!     /Users/dan/Google Drive/Projects/dotfiles/npm-debug.log</div><div class="line">npm ERR! not ok code 0</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="寻求解决"><a href="#寻求解决" class="headerlink" title="寻求解决"></a>寻求解决</h3><p><a href="https://github.com/npm/npm/issues/4099" target="_blank" rel="external">github issue npm update -g has broken npm#4099</a></p>
<p>这里面其中有人提到可以通过下面命令行来获取重新安装npm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -L http://npmjs.org/install.sh | sudo sh</div></pre></td></tr></table></figure>
<p>试了一下，成功了。</p>
<p>但是有两个问题</p>
<p>1 为什么这样就行了？ 上述命令行下载npm重新安装即可。</p>
<p>2 为什么 通过<code>npm install npm -g</code>升级（忘记加sudo）就挂了，讲道理以前这种情况，基本上是给个提示的么，然后正确操作即可。</p>
<p>贴几个社区讨论的地址</p>
<p><a href="https://gist.github.com/DanHerbert/9520689" target="_blank" rel="external">Fixing npm On Mac OS X for Homebrew Users</a></p>
<p><a href="https://github.com/npm/npm/issues/3794" target="_blank" rel="external">Error: Refusing to delete: /usr/local/bin/npm #3794</a></p>
<blockquote>
<p>If you’re a Homebrew user and you installed node via Homebrew, there is a major philosophical issue with the way Homebrew and NPM work together. If you install node with Homebrew and then try to do npm update npm -g, you may see an error like this:</p>
<p>There’s an NPM bug for this exact problem. The bug has been “fixed” by Homebrew installing npm in a way that allows it to manage itself once the install is complete. However, this is error-prone and still seems to cause problems for some people. The root of the the issue is really that npm is its own package manager and it is therefore better to have npm manage itself and its packages completely on its own instead of letting Homebrew do it.</p>
<p>Also, using the Homebrew installation of npm will require you to use sudo when installing global packages. Since one of the core ideas behind Homebrew is that apps can be installed without giving them root access, this is a bad idea.</p>
</blockquote>
<p>先说下<a href="http://brew.sh/" target="_blank" rel="external">Homebrew</a>(家酿 好名字)，就是Mac OSX的软件包管理工具，可以通过<code>brew</code>命令在os x中安装或卸载软件很方便，类似于Ubuntu中的<code>apt-get</code>命令吧。表示从来没用过… 命令行安装软件确实挺酷的</p>
<p>我对上面问题分析的理解是：OS X中node好像是自带就有的，是通过homebrew的方式安装的，npm也是通过homebrew的安装的，那么问题来了，npm本身也是一个包管理工具。</p>
<p><code>npm install npm -g</code>可能并不是通过npm的方式去安装升级自己，而是通过<code>brew</code>的方式去安装，因为安装的是全局变没有加sudo所以导致npm的安装失败并使得npm broken。</p>
<p>所以有人建议</p>
<blockquote>
<p>I still recommend to get homebrew to manage node, and get npm to manage itself. If you do npm install -gf npm, probably you will get into trouble when there is a new version of npm available from homebrew, and you do brew upgrade.</p>
<p>npm can manage the update of itself, so it does not make much sense to get homebrew to manage npm. However, manually update nodejs is painful. Therefore, I think it’s best to get homebrew to manage nodejs, and get npm to manage itself.</p>
</blockquote>
<p>npm和homebrew独立开，不要通过homebrew的方式来安装npm。</p>
<h3 id="一些知识点"><a href="#一些知识点" class="headerlink" title="一些知识点"></a>一些知识点</h3><p>curl命令行：curl是一个命令行工具，作用是发出网络请求，然后得到和提取数据显示在标准输出stdout上。</p>
<p><a href="http://www.ruanyifeng.com/blog/2011/09/curl.html" target="_blank" rel="external">阮一峰  curl网站开发指南</a></p>
<p><a href="http://blog.51yip.com/linux/1049.html" target="_blank" rel="external">inux curl 命令详解，以及实例</a></p>
<p><a href="http://www.cnblogs.com/TankXiao/p/3247113.html" target="_blank" rel="external">Homebrew的安装与使用</a></p>
<p><a href="http://col.dog/2015/11/22/homebrew/" target="_blank" rel="external">Mac下的软件安装</a></p>
<p><a href="http://www.yangzhiping.com/tech/homebrew-cask.html" target="_blank" rel="external">Mac安装软件新方法 Homebrew-cask</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/05/31/编写可维护的JavaScript-笔记一/" class="prev">PREV</a><a href="/2016/03/23/git学习笔记-三-之分支学习/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 <a href="http://yoursite.com">jingxiao</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>